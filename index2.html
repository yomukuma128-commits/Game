<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>チェッカー 強化AI版</title>
<style>
body{text-align:center;font-family:sans-serif}
#board{
 display:grid;
 grid-template-columns:repeat(8,60px);
 width:480px;margin:auto
}
.square{width:60px;height:60px;display:flex;justify-content:center;align-items:center}
.black{background:#444}.red{background:#eee}
.piece{width:45px;height:45px;border-radius:50%;cursor:pointer}
.white-piece{background:white}.black-piece{background:black}
.selected{outline:3px solid yellow}
</style>
</head>
<body>

<h1>チェッカー（AI強化版）</h1>

<select id="mode">
 <option value="pvp">対人戦</option>
 <option value="cpu">コンピュータ戦</option>
</select>

<select id="level">
 <option value="1">AI Lv1</option>
 <option value="2">AI Lv2</option>
 <option value="3">AI Lv3</option>
</select>

<button onclick="resetGame()">リセット</button>
<p id="status"></p>
<div id="board"></div>

<script>
const board=document.getElementById("board");
const status=document.getElementById("status");
let state, current="white", selected=null;

function resetGame(){
 state=Array(8).fill().map(()=>Array(8).fill(null));
 current="white";selected=null;
 for(let y=0;y<3;y++)for(let x=0;x<8;x++)if((x+y)%2)state[y][x]="black";
 for(let y=5;y<8;y++)for(let x=0;x<8;x++)if((x+y)%2)state[y][x]="white";
 draw();
}

function draw(){
 board.innerHTML="";
 for(let y=0;y<8;y++)for(let x=0;x<8;x++){
  const s=document.createElement("div");
  s.className="square "+((x+y)%2?"black":"red");
  s.onclick=()=>click(x,y);
  if(state[y][x]){
   const p=document.createElement("div");
   p.className="piece "+state[y][x]+"-piece";
   if(selected && selected.x===x && selected.y===y)p.classList.add("selected");
   s.appendChild(p);
  }
  board.appendChild(s);
 }
 status.textContent=current+"の番";
}

function click(x,y){
 if(document.getElementById("mode").value==="cpu" && current==="black")return;
 if(selected){
  if(doMove(state,selected.x,selected.y,x,y)){
   selected=null;turn();
  }else selected=null;
 }else if(state[y][x]===current) selected={x,y};
 draw();
}

function doMove(b,sx,sy,tx,ty){
 if(b[ty][tx])return false;
 let dx=tx-sx,dy=ty-sy,dir=current==="white"?-1:1;
 if(Math.abs(dx)===1 && dy===dir){
  b[ty][tx]=b[sy][sx];b[sy][sx]=null;return true;
 }
 if(Math.abs(dx)===2 && dy===dir*2){
  let mx=sx+dx/2,my=sy+dy/2;
  if(b[my][mx] && b[my][mx]!==current){
   b[ty][tx]=b[sy][sx];b[sy][sx]=null;b[my][mx]=null;
   return true;
  }
 }
 return false;
}

function turn(){
 current=current==="white"?"black":"white";
 draw();
 if(document.getElementById("mode").value==="cpu" && current==="black")
  setTimeout(cpuMove,400);
}

function cpuMove(){
 let lv=+document.getElementById("level").value;
 let moves=getAllMoves("black");
 if(lv>=2){
  let caps=moves.filter(m=>Math.abs(m.tx-m.sx)===2);
  if(caps.length)moves=caps;
 }
 if(lv===3){
  moves.sort((a,b)=>score(b)-score(a));
 }
 let m=moves[Math.floor(Math.random()*moves.length)];
 doMove(state,m.sx,m.sy,m.tx,m.ty);
 turn();
}

function getAllMoves(player){
 let list=[];
 for(let y=0;y<8;y++)for(let x=0;x<8;x++)
  if(state[y][x]===player){
   [[1,1],[-1,1],[2,2],[-2,2]].forEach(d=>{
    let nx=x+d[0],ny=y+d[1];
    if(nx>=0&&ny>=0&&nx<8&&ny<8){
     let copy=JSON.parse(JSON.stringify(state));
     current=player;
     if(doMove(copy,x,y,nx,ny))
      list.push({sx:x,sy:y,tx:nx,ty:ny,board:copy});
    }
   });
  }
 return list;
}

function score(m){
 let s=0;
 for(let y=0;y<8;y++)for(let x=0;x<8;x++){
  if(m.board[y][x]==="black")s+=10;
  if(m.board[y][x]==="white")s-=10;
 }
 return s;
}

resetGame();
</script>
</body>
</html>
